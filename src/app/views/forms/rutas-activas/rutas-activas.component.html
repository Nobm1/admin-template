<h2> Rutas Activas</h2>



<table> 
  <tr>
    <td>
      <form class="row row-cols-sm-auto">
        <div class="col-12">
          <div class="input-group">
            <input
              class="form-control"
              placeholder={{fechaActual}}
              name="dp"
              [(ngModel)]="model"
              ngbDatepicker
              #d="ngbDatepicker"
            />
            <button class="btn btn-outline-secondary bi bi-calendar" (click)="d.toggle()" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm64 80v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm128 0v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H336zM64 400v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H208zm112 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"/></svg>
            </button>
          </div>
        </div>
      </form>
    </td>
    <td>
      <button cButton  color="secondary" size="sm" (click)="getNombreByFecha(model)"> buscar</button>
    </td>
  </tr>
</table>

<p></p>
<table *ngIf="nombresRutas">
  <tbody>
    <tr *ngFor="let grupo of nombresRutas.slice(0, 6); let i = index">
      <td *ngFor="let nombre of nombresRutas.slice(i * 6, (i + 1) * 6)">
        <button cButton  color="success" size="sm" (click)="buscarRuta(nombre.Nombre_ruta,nombre.Estado)" *ngIf="nombre.Estado == true">
          {{nombre.Nombre_ruta}}
          <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 640 512">
            <path d="M48 0C21.5 0 0 21.5 0 48V368c0 26.5 21.5 48 48 48H64c0 53 43 96 96 96s96-43 96-96H384c0 53 43 96 96 96s96-43 96-96h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V288 256 237.3c0-17-6.7-33.3-18.7-45.3L512 114.7c-12-12-28.3-18.7-45.3-18.7H416V48c0-26.5-21.5-48-48-48H48zM416 160h50.7L544 237.3V256H416V160zM112 416a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm368-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/>
          </svg>
        </button>
        <button cButton  color="secondary" size="sm" (click)="buscarRuta(nombre.Nombre_ruta,nombre.Estado)" *ngIf="nombre.Estado == false">
          {{nombre.Nombre_ruta}}
          <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 640 512"><path d="M112 0C85.5 0 64 21.5 64 48V96H16c-8.8 0-16 7.2-16 16s7.2 16 16 16H64 272c8.8 0 16 7.2 16 16s-7.2 16-16 16H64 48c-8.8 0-16 7.2-16 16s7.2 16 16 16H64 240c8.8 0 16 7.2 16 16s-7.2 16-16 16H64 16c-8.8 0-16 7.2-16 16s7.2 16 16 16H64 208c8.8 0 16 7.2 16 16s-7.2 16-16 16H64V416c0 53 43 96 96 96s96-43 96-96H384c0 53 43 96 96 96s96-43 96-96h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V288 256 237.3c0-17-6.7-33.3-18.7-45.3L512 114.7c-12-12-28.3-18.7-45.3-18.7H416V48c0-26.5-21.5-48-48-48H112zM544 237.3V256H416V160h50.7L544 237.3zM160 368a48 48 0 1 1 0 96 48 48 0 1 1 0-96zm272 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0z"/>
          </svg>
        </button>
      </td>
    </tr>
  </tbody>
</table>

<p></p>

<h3 *ngIf="isRuta == false">En este dia no hay rutas</h3>

<h4>{{nombreRutaActual}}</h4>

<div *ngIf="isDriver">
  <h4>Patente : {{patenteRuta}}</h4>
  <h4>Driver : {{driverRuta}}</h4>
  
</div>

<table class="greenTable" id="tablaRutaActiva" *ngIf="isClicked == true" >
  <thead>
    <tr>
        <!-- <th>Código de Cliente</th> -->
        <th>Posición</th>
        <!-- <th>Nombre ruta</th> -->
        <th>Código de Pedido</th>
        <th>Comuna</th>
        <th>SKU</th>
        <th>Producto</th>
        <th>Unidades</th>
        <th>Bultos</th>
        <th>Nombre de cliente</th>
        <th>Dirección cliente</th>
        <th>Teléfono</th>
        <!-- <th>Validado</th>
        <th>DE</th>
        <th>DF</th> -->
    </tr>
  </thead>
  <tbody cdkDropList (cdkDropListDropped)="drop($event)">
    <tr *ngFor="let ruta of rutaEnActivo; let j = index">
      <td cdkDrag cdkDragLockAxis="y">{{ruta.Pos }}</td>
      <!-- <th>{{nombreRutaActual}}</th> -->
      <td>{{ruta.Codigo_pedido }}</td>
      <td>{{ruta.Comuna }}</td>
      <td>
        <table>
          <tr *ngFor="let sku of ruta.arraySKU">
            {{sku}}
          </tr>
        </table>
      </td>
      <td><table style="text-align: left">
        <tr *ngFor="let producto of ruta.arrayProductos" >
          {{producto}}
        </tr>
      </table></td>
      <td>{{ruta.Unidades }}</td>
      <td>{{ruta.Bultos }}</td>
      <td>{{ruta.Nombre_cliente }}</td>
      <td>{{ruta.Direccion_cliente }}</td>
      <td>{{ruta.Telefono }}</td>
      
      <!-- <td>{{ruta.Validacion }}</td>
      <td>{{ruta.DE }}</td>
      <td>{{ruta.DP }}</td> -->

      <div *cdkDragPreview matchSize="true" class="container dragdrop-placeholder">
        {{ruta.Codigo_pedido}}
      </div>
    </tr>


  </tbody>
  </table>

  <p></p>


  <table>
    <tr >
      <td>
        <button  *ngIf="isClicked == true && isActive == true && rol == '5'" cButton  color="secondary" size="sm" (click)="updateEstadoRuta(nombreRutaActual,model)" > Cerrar Ruta 
          <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 640 512">
            <path d="M48 0C21.5 0 0 21.5 0 48V368c0 26.5 21.5 48 48 48H64c0 53 43 96 96 96s96-43 96-96H384c0 53 43 96 96 96s96-43 96-96h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V288 256 237.3c0-17-6.7-33.3-18.7-45.3L512 114.7c-12-12-28.3-18.7-45.3-18.7H416V48c0-26.5-21.5-48-48-48H48zM416 160h50.7L544 237.3V256H416V160zM112 416a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm368-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/>
          </svg>
        </button>
      </td>
      <td >
        <button *ngIf="isClicked == true" (click)="downloadExcel(nombreRutaActual, patenteRuta, driverRuta)" cButton  color="secondary" size="sm"> Descargar
          <svg class="dExcel" xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 384 512">
            <path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM155.7 250.2L192 302.1l36.3-51.9c7.6-10.9 22.6-13.5 33.4-5.9s13.5 22.6 5.9 33.4L221.3 344l46.4 66.2c7.6 10.9 5 25.8-5.9 33.4s-25.8 5-33.4-5.9L192 385.8l-36.3 51.9c-7.6 10.9-22.6 13.5-33.4 5.9s-13.5-22.6-5.9-33.4L162.7 344l-46.4-66.2c-7.6-10.9-5-25.8 5.9-33.4s25.8-5 33.4 5.9z"/>
          </svg>
          </button>
      </td>

      <td *ngIf="isActive == true" >
        <button cButton  color="secondary" size="sm" (click)="editarRutaActiva()">
          Editar ruta
          <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512"><path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"/>
          </svg>
        </button>
      </td>

      <td *ngIf="isActive == true" >
        <button cButton  color="success" size="sm" (click)="asignarRuta()" >
          Asignar ruta
          <!-- <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>
          </svg> -->
        </button>
      </td>

      <td>
        <button cButton size="sm" color="warning" (click)="downloadExcelBeetrack()" *ngIf="isDriver && isActive == true">Beetrack   
          <svg class="dExcel" xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 384 512">
            <path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM155.7 250.2L192 302.1l36.3-51.9c7.6-10.9 22.6-13.5 33.4-5.9s13.5 22.6 5.9 33.4L221.3 344l46.4 66.2c7.6 10.9 5 25.8-5.9 33.4s-25.8 5-33.4-5.9L192 385.8l-36.3 51.9c-7.6 10.9-22.6 13.5-33.4 5.9s-13.5-22.6-5.9-33.4L162.7 344l-46.4-66.2c-7.6-10.9-5-25.8 5.9-33.4s25.8-5 33.4 5.9z"/>
          </svg>
        </button>
      </td>
    </tr>
  </table>
 


  
